<!DOCTYPE html>
<html lang="sv-SE">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <link rel="canonical" href="https://516kläppen.com/" />
  <meta name="robots" content="index,follow,max-image-preview:large" />
  <title>516 Kläppen i Sälen – stuga med ski-in/ski-out (8 bäddar)</title>
  <meta name="description" content="Stuga i Sälen (Kläppen): familjevänligt, ski-in/ski-out, bastu, kamin, snabbt Wi-Fi och 8 bäddar. Se lediga veckor och skicka bokningsförfrågan." />
  <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#0b0b0b" media="(prefers-color-scheme: dark)">
  <link rel="icon" href="favicon.ico" />
  <!-- Open Graph -->
  <meta property="og:title" content="516 Kläppen – Familjevänlig stuga med ski-in/ski-out" />
  <meta property="og:description" content="Ski-in/ski-out, bastu, kamin och Wi-Fi. Se lediga veckor och boka." />
  <meta property="og:image" content="OG_IMAGE_1200x630.jpg" />
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="sv_SE" />

  <style>
    /* ===== Design Tokens ===== */
    :root{
      --maxw: 1200px;
      --gutter: clamp(16px, 3vw, 28px);

      --bg:#f7f7f7; --paper:#fff; --ink:#0a0a0a; --muted:#6b7280; --line:#e6e7eb;
      --brand:#111111; --accent:#0b84fe; --ok:#16a34a; --no:#ef4444; --warn:#f59e0b;
      --shadow: 0 10px 30px rgba(0,0,0,.06);
      --r-lg:20px; --r-md:14px;

      --fs--1: clamp(.9rem, .85rem + .2vw, 1rem);
      --fs-0: clamp(1rem, .96rem + .3vw, 1.08rem);
      --fs-1: clamp(1.15rem, 1.05rem + .6vw, 1.35rem);
      --fs-2: clamp(1.35rem, 1.2rem + .8vw, 1.7rem);
      --fs-3: clamp(1.8rem, 1.6rem + 1.4vw, 2.4rem);
      --fs-4: clamp(2.2rem, 1.9rem + 2vw, 3rem);
    }
    @media (prefers-color-scheme: dark){
      :root{ --bg:#0b0b0b; --paper:#101010; --ink:#f2f2f2; --muted:#9aa0a6; --line:#1f1f1f; --accent:#4aa3ff; --shadow:0 10px 30px rgba(0,0,0,.4); }
    }

    /* Base */
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--ink); background:var(--bg);
      font:16px/1.6 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; text-rendering:optimizeLegibility;
    }
    a{color:inherit; text-decoration:none}
    a:focus-visible, .btn:focus-visible{outline:2px solid var(--accent); outline-offset:3px; border-radius:12px}
    img{display:block; max-width:100%; height:auto}

    .container{max-width:var(--maxw); margin-inline:auto; padding-inline:var(--gutter);}
    .section{margin-block: clamp(28px, 5vw, 48px)}
    .paper{background:var(--paper); border:1px solid var(--line); border-radius:var(--r-lg); box-shadow:var(--shadow)}
    .muted{color:var(--muted)}
    .center{text-align:center}
    .grid{display:grid; gap: clamp(10px, 2.5vw, 16px); justify-items:center}

    /* Nav */
    .nav{display:flex; align-items:center; justify-content:space-between; gap:12px; padding-block:12px}
    .brand{font-weight:800; letter-spacing:.2px}
    .badge{display:inline-flex; align-items:center; gap:10px; background:var(--paper); border:1px solid var(--line); padding:10px 14px; border-radius:999px; box-shadow:var(--shadow); font-size:var(--fs--1)}
    .badge svg{width:18px;height:18px}

    /* Hero */
    .hero{position:relative; border-radius:var(--r-lg); overflow:hidden; box-shadow:var(--shadow)}
    .hero .media{width:100%; aspect-ratio:16/9; background:#000}
    .hero .media img{width:100%; height:100%; object-fit:cover}
    .hero .overlay{position:absolute; inset:0; background:linear-gradient(180deg, rgba(0,0,0,.45), rgba(0,0,0,.65));}

    .hero .content{position:absolute; inset:0; display:grid; place-items:end center; padding: clamp(16px, 4vw, 32px); color:#fff; text-align:center}
    .eyebrow{opacity:.9; font-size:var(--fs--1); letter-spacing:.02em}
    h1{margin:.2em 0 .4em; font-weight:800; line-height:1.1; font-size:var(--fs-4)}
    .sub{opacity:.95; font-size:var(--fs-1); max-width:72ch; margin-inline:auto}
    .cta{margin-top:14px; display:flex; gap:10px; flex-wrap:wrap; justify-content:center}
    .btn{display:inline-flex; align-items:center; gap:10px; background:#fff; color:#111; font-weight:800; padding:12px 18px; border-radius:14px; border:1px solid #fff; box-shadow:var(--shadow); transition:transform .06s ease, box-shadow .2s ease}
    .btn:hover{transform:translateY(-1px)}
    .btn.outline{background:transparent; color:#fff; border-color:rgba(255,255,255,.7)}
    .btn.icon svg{width:18px; height:18px}

    /* Features */
    .features{grid-template-columns: repeat(4, minmax(0,1fr))}
    .card{padding: clamp(14px, 2.5vw, 18px); text-align:center}
    .card h3{margin:6px 0 4px; font-size:var(--fs-1); line-height:1.2}

    /* Gallery / Explore */
    .gallery{grid-template-columns: repeat(3, minmax(0,1fr))}
    .tile{border-radius:var(--r-lg); overflow:hidden; border:1px solid var(--line); box-shadow:var(--shadow)}
    .tile img{aspect-ratio:4/3; object-fit:cover}

    /* Split blocks */
    .split{display:grid; grid-template-columns: 1.1fr .9fr; gap: clamp(12px, 3vw, 18px); align-items:start}
    .list{padding: clamp(14px, 2.5vw, 18px)}
    .list ul{margin:0; padding-left: 18px}
    .contact{padding: clamp(14px, 2.5vw, 18px)}
    .stack{display:flex; flex-direction:column; gap:10px}
    .btn.block{justify-content:center; width:100%}
    .notice{font-size:var(--fs--1); color:var(--muted); text-align:center}

    /* Availability legend + cards (base) */
    .legend{display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap; font-size:var(--fs--1); margin-bottom:8px}
    .chip{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border:1px solid var(--line); border-radius:999px; background:var(--paper)}
    .dot{width:10px; height:10px; border-radius:999px}
    .dot.ok{background:var(--ok)} .dot.no{background:var(--no)} .dot.pending{background:var(--warn)}

    .calendar{grid-template-columns: repeat(4, minmax(0,1fr))}
    .week{width:100%; padding:14px; border-radius:var(--r-md); border:1px solid var(--line); background:var(--paper); display:grid; gap:6px; justify-items:center; text-align:center; min-height:110px}
    .week strong{font-weight:800}
    .tag{font-size:var(--fs--1); border-radius:999px; padding:4px 8px; border:1px solid var(--line); background:var(--paper)}
    .available{outline:2px solid rgba(22,163,74,.26)}
    .tag.ok{border-color:rgba(22,163,74,.35); color:#065f46}
    .tag.no{border-color:rgba(239,68,68,.35); color:#7f1d1d}
    .tag.pending{border-color:rgba(245,158,11,.35); color:#7a3d00}

    /* Season toggle */
    .seasonToggle{display:flex; justify-content:center; gap:10px; margin: 8px 0 12px}
    .toggleBtn{
      padding:10px 14px; border-radius:999px; border:1px solid var(--line);
      background:var(--paper); font-weight:800; cursor:pointer; box-shadow:var(--shadow)
    }
    .toggleBtn.active{background:var(--brand); color:#fff; border-color:var(--brand)}

    /* FAQ / Reviews */
    .faq{grid-template-columns: repeat(2, minmax(0,1fr))}
    details{width:100%}
    details summary{cursor:pointer; list-style:none; font-weight:700; padding:12px 0}
    details summary::-webkit-details-marker{display:none}
    .answer{border-top:1px solid var(--line); padding-top:8px; color:var(--muted)}

    /* Sticky mobile bar */
    .sticky{position:sticky; bottom:0; z-index:50; background: color-mix(in srgb, var(--paper) 92%, transparent); backdrop-filter: saturate(140%) blur(12px); border-top:1px solid var(--line); display:none; padding-bottom: env(safe-area-inset-bottom, 0)}
    .sticky .inner{max-width:var(--maxw); margin:0 auto; padding:10px var(--gutter); display:flex; justify-content:space-between; align-items:center; gap:10px}
    .smBtn{padding:10px 14px; border-radius:12px; border:1px solid var(--line); background:var(--paper); font-weight:800}
    .smBtn.primary{background:var(--brand); color:#fff; border-color:var(--brand)}

    /* Footer */
    footer{padding: clamp(20px, 4vw, 32px) 0; color:var(--muted); font-size:var(--fs--1); text-align:center}

    /* Compact month view */
    .summaryCounts{ text-align:center; margin:10px 0 6px; font-weight:800 }
    .monthGrid{ display:grid; gap:10px }
    .monthRow{ display:grid; grid-template-columns: 160px 1fr; gap:10px; align-items:start }
    .monthName{ font-weight:800; text-transform:capitalize; text-align:right; padding:8px 6px }
    .weeksWrap{ display:flex; flex-wrap:wrap; gap:6px }
    .weekPill{
      font-weight:800; font-size:var(--fs--1); line-height:1;
      border-radius:999px; padding:10px 12px; border:1px solid var(--line);
      background:var(--paper); user-select:text; cursor:default; /* not clickable */
    }
    .weekPill.ok{ background:color-mix(in srgb, var(--ok) 12%, var(--paper)); border-color:color-mix(in srgb, var(--ok) 38%, var(--line)); }
    .weekPill.pending{ background:color-mix(in srgb, var(--warn) 12%, var(--paper)); border-color:color-mix(in srgb, var(--warn) 38%, var(--line)); }
    .weekPill.no{ background:color-mix(in srgb, var(--no) 12%, var(--paper)); border-color:color-mix(in srgb, var(--no) 38%, var(--line)); }
    .weekPill .range{ opacity:.75; margin-left:6px; font-weight:600 }
    @media (max-width: 700px){
      .monthRow{ grid-template-columns: 1fr }
      .monthName{ text-align:left }
    }
    
    /* Responsive */
    @media (max-width: 1100px){
      .features{grid-template-columns: repeat(2, minmax(0,1fr))}
      .calendar{grid-template-columns: repeat(2, minmax(0,1fr))}
      .gallery{grid-template-columns: repeat(2, minmax(0,1fr))}
      .split{grid-template-columns:1fr}
      .list, .contact{text-align:center}
      .list ul{display:inline-block; text-align:left}
    }
    @media (max-width: 560px){
      .features, .calendar{grid-template-columns:1fr}
      .sticky{display:block}
      h1{font-size:var(--fs-3)}
    }

    /* A11y / motion / print */
    @media (prefers-reduced-motion: reduce){ *{animation:none !important; transition:none !important} }
    @media print{ .nav,.hero,.cta,.features,.gallery,.sticky,footer{display:none !important} body{background:#fff;color:#000} .container{padding:0} }
  </style>

  <!-- JSON-LD -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"LodgingBusiness",
    "name":"516 Kläppen",
    "description":"Familjevänlig stuga halvvägs upp för backen i Kläppen. Ski-in/ski-out, bastu, kamin och Wi-Fi.",
    "amenityFeature":[
      {"@type":"LocationFeatureSpecification","name":"Ski-in/ski-out","value":true},
      {"@type":"LocationFeatureSpecification","name":"Bastu","value":true},
      {"@type":"LocationFeatureSpecification","name":"Öppen spis","value":true},
      {"@type":"LocationFeatureSpecification","name":"Wi-Fi","value":true},
      {"@type":"LocationFeatureSpecification","name":"Parkering","value":true}
    ],
    "address":{"@type":"PostalAddress","addressCountry":"SE","addressLocality":"Kläppen"},
    "image":"OG_IMAGE_1200x630.jpg",
    "url":"https://www.dindomain.se",
    "telephone":"+46703275845",
    "priceRange":"7000 SEK/vecka (1000 SEK/dygn)"
  }
  </script>
</head>
<body>

  <!-- NAV -->
  <header class="container nav" aria-label="Toppnavigering">
    <div class="brand">516 Kläppen</div>
    <div class="badge" title="Halvvägs upp för backen · Ski-in/Ski-out">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true"><path stroke-width="1.6" d="M3 18l7-12 4 7 3-5 4 10H3z"/></svg>
      Mitt i pisten - halvvägs upp för backen
    </div>
  </header>

  <!-- HERO -->
  <section class="container section">
    <div class="hero" aria-label="Omslagsbild">
      <div class="media">
        <picture>
          <img src="klappen_appen.jpeg"
               alt="Vintervit skog i Kläppen, snö och tallar"
               loading="eager" decoding="async"
               style="width:100%;height:100%;object-fit:cover;object-position:center;" />
        </picture>
      </div>
      <div class="overlay" aria-hidden="true"></div>
      <div class="content">
        <div class="center">
          <div class="eyebrow">Kläppen, Dalarna · Ski-in/Ski-out</div>
          <h1>Charmigt familjeboende i Kläppen</h1>
          <p class="sub">Två sovrum (8 bäddar), bastu, kamin, snabbt Wi-Fi och parkering – halvvägs upp för backen. Boka ditt perfekta semesterboende redan idag.</p>
          <div class="cta">
            <a class="btn icon" href="#boka" aria-label="Gå till bokning">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="3"/><path d="M16 2v4M8 2v4M3 10h18"/></svg>
              Se lediga veckor & boka
            </a>
            <a class="btn outline" href="#om">Läs mer</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- FEATURES -->
  <section class="container section">
    <div class="grid features">
      <article class="paper card"><h3>Perfekt läge</h3><p class="muted">Halvvägs upp för backen – nära lift och längdspår.</p></article>
      <article class="paper card"><h3>Familjevänligt</h3><p class="muted">8 bäddar, barnvänligt, fullt kök och tvätt.</p></article>
      <article class="paper card"><h3>Avkoppling</h3><p class="muted">Bastu och öppen spis för mysiga kvällar.</p></article>
      <article class="paper card"><h3>Uppkopplat</h3><p class="muted">Snabbt Wi-Fi för jobb, streaming och spel.</p></article>
    </div>
  </section>

  <!-- OM / ABOUT -->
  <section class="container section" id="om">
    <div class="paper list center">
      <h2>Om 516 Kläppen</h2>
      <p>Vår stuga ligger i ett lugnt område med ski-in/ski-out och närhet till både liftar och längdspår. Perfekt för familjer som vill koppla av och njuta av fjällmiljön.</p>
      <figure class="housePhoto">
        <img
          src="klappen_hus_2copy.jpeg"
          alt="Stugan på 516 Kläppen – fasadvy i vinterskrud"
          style="width:100%;aspect-ratio:4/3;object-fit:cover;background:#f0f2f5;border:1px solid var(--line);border-radius:var(--r-lg);box-shadow:var(--shadow);" />
        <figcaption class="muted">Fasadvy – halvvägs upp för backen, nära lift och längdspår.</figcaption>
      </figure>
      <ul style="display:inline-block; text-align:left">
        <li>2 sovrum + loft (8 bäddar)</li>
        <li>Bastu, öppen spis, torkskåp</li>
        <li>Fullt utrustat kök (spis/ugn, diskmaskin, mikro, kaffebryggare)</li>
        <li>TV, snabbt Wi-Fi</li>
        <li>Ski-storage & parkering vid huset</li>
      </ul>
    </div>
  </section>

  <!-- EXPLORE / GALLERY -->
  <section class="container section" id="utforska" aria-label="Utforska Kläppen">
    <h2 class="center">Utforska Kläppen</h2>
    <div class="grid gallery">
      <a class="tile" href="#" aria-label="Utsikt"><img src="G1.jpg" alt="Utsikt från stugan"></a>
      <a class="tile" href="#" aria-label="Interiör"><img src="G2.jpg" alt="Interiör med kamin"></a>
      <a class="tile" href="#" aria-label="Backe"><img src="G3.jpg" alt="Backe nära stugan"></a>
    </div>
  </section>

  <!-- DETAILS / CONTACT -->
  <section class="container section" id="detaljer">
    <div class="split">
      <div class="paper list center">
        <h2>Detaljer & pris</h2>
        <p><strong>Pris:</strong> <span id="pris">7000 SEK/vecka (1000 SEK/dygn)</span> (säsongsvariationer förekommer). <strong>Rökfritt</strong> och <strong>inga husdjur</strong>.</p>
        <p class="muted">Faktura/Swish efter bekräftad bokning.</p>
      </div>
      <aside class="paper contact center">
        <h2>Kontakt</h2>
        <div class="stack" role="group" aria-label="Kontaktalternativ">
          <a class="btn block" href="https://docs.google.com/forms/d/e/1FAIpQLSd9ln4SxS2innp2ePUCPE21DtUbBS9gO1Y-4n2cksiLSqfEuw/viewform?usp=preview" target="_blank" rel="noopener">Skicka bokningsförfrågan</a>
          <a class="btn block" href="tel:+46703275845">Ring: +46703275845</a>
          <a class="btn block" href="mailto:mikaelvispen@gmail.com">Maila: mikaelvispen@gmail.com</a>
        </div>
        <p class="muted" style="margin-top:8px">Adress: 516 Kläppen, 780 68 Transtrand</p>
      </aside>
    </div>
  </section>

  <!-- AVAILABILITY / BOOK -->
  <section class="container section" id="boka">
    <h2 class="center">Kalender – lediga veckor</h2>

    <!-- season toggle -->
    <div class="seasonToggle" role="tablist" aria-label="Säsongsväljare">
      <button class="toggleBtn active" role="tab" aria-selected="true" data-season="winter">Vinter 2025–2026</button>
      <button class="toggleBtn" role="tab" aria-selected="false" data-season="summer">Sommar 2026</button>
    </div>

    <div class="legend">
      <span class="chip"><span class="dot ok"></span> Ledigt</span>
      <span class="chip"><span class="dot pending"></span> På förfrågan</span>
      <span class="chip"><span class="dot no"></span> Bokat</span>
    </div>

    <!-- weeks grid populated by JS -->
    <div class="summaryCounts" id="seasonSummary" aria-live="polite"></div>
    <div class="monthGrid" id="calendarGrid" aria-label="Veckokalender, ej interaktiv"></div>

    <div class="section split">
      <div class="paper list center">
        <h2>Så här bokar du</h2>
        <ol style="display:inline-block; text-align:left; margin:0; padding-left:18px">
          <li>Hitta en ledig vecka i listan ovan.</li>
          <li>Klicka på <strong>“Skicka bokningsförfrågan”</strong> och fyll i uppgifterna.</li>
          <li>Vi bekräftar via e-post/SMS och skickar betalinfo.</li>
        </ol>
        <p class="notice">Särskilda önskemål (sen ankomst)? Lägg till i meddelandefältet.</p>
      </div>
      <aside class="contact center">
        <h2>Boka nu</h2>
        <div class="stack">
          <a class="btn block" href="https://docs.google.com/forms/d/e/1FAIpQLSd9ln4SxS2innp2ePUCPE21DtUbBS9gO1Y-4n2cksiLSqfEuw/viewform?usp=preview" target="_blank" rel="noopener">Skicka bokningsförfrågan</a>
          <a class="btn block" href="#om">Läs mer om stugan</a>
        </div>
      </aside>
    </div>
  </section>

  <!-- FAQ -->
  <section class="container section" id="faq">
    <div class="paper list" style="width:100%">
      <h2 class="center">Vanliga frågor</h2>
      <details><summary>Ingår sängkläder och handdukar?</summary><div class="answer">Finns att tillgå men behöver tvättas och tumlas i masking efter användning. Meddela gärna i bokningsformuläret i förväg.</div></details>
      <details><summary>Är slutstädning inkluderad?</summary><div class="answer">Nej, enkla städinstruktioner finns i stugan. Har ni frågor i förväg så hör gärna av er.</div></details>
      <details><summary>Är husdjur tillåtna?</summary><div class="answer">Tyvärr inte, på grund av allergi så är stugan rök- och djurfri.</div></details>
    </div>
  </section>

  <!-- CONTACT / HOURS -->
  <section class="container section" id="kontakt">
    <div class="paper list center" style="padding:20px">
      <h2>Kontakt & öppettider</h2>
      <p class="muted">516 Kläppen · 780 68 Transtrand · Tel: +46703275845· <a href="mailto:mikaelvisp
    </div>
  </section>

  <!-- STICKY MOBILE BAR -->
  <div class="sticky" aria-hidden="true">
    <div class="inner">
      <div style="font-weight:800">516 Kläppen</div>
      <div style="display:flex; gap:8px">
        <a class="smBtn" href="tel:+46703275845">Ring</a>
        <a class="smBtn primary" href="https://docs.google.com/forms/d/e/1FAIpQLSd9ln4SxS2innp2ePUCPE21DtUbBS9gO1Y-4n2cksiLSqfEuw/viewform?usp=dialog" target="_blank" rel="noopener">Boka</a>
      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <footer class="container">
    <div>© <span id="year"></span> 516 Kläppen. Alla rättigheter förbehålles.</div>
  </footer>

  <script>
    // Footer year
    (function(){var y=document.getElementById('year'); if(y) y.textContent=(new Date()).getFullYear();})();
  
    /* ============ Robust season calendar (GH Pages friendly) ============ */
    // Seasons
    var SEASONS = {
      winter: { start: '2025-12-01', end: '2026-04-30', label: 'Vinter 2025–2026' },
      summer: { start: '2026-05-01', end: '2026-10-31', label: 'Sommar 2026' }
    };
  
    // Admin availability: keys are ISO week codes "YYYY-Www". Values: 'booked' | 'pending' | 'available'
    var WEEK_STATUS = {
      '2025-W51': 'booked',
      '2025-W52': 'booked',
      '2026-W01': 'booked',
      '2026-W02': 'booked',
      '2026-W03': 'pending',
      '2026-W04': 'booked',
      '2026-W05': 'booked',
      '2026-W07': 'pending',
      '2026-W08': 'booked',
      '2026-W09': 'booked',
      '2026-W10': 'booked',
      '2026-W15': 'booked',
      '2026-W26': 'pending', 
      '2026-W33': 'booked', 
    };
  
    // ---- Small utilities (avoid newer syntax for max compatibility) ----
    function toDate(str){ // 'YYYY-MM-DD' -> Date (local, 12:00 to dodge DST)
      var p=str.split('-'); var d=new Date(+p[0], +p[1]-1, +p[2], 12, 0, 0, 0);
      return d;
    }
    function addDays(d,n){ var r=new Date(d.getTime()); r.setDate(r.getDate()+n); return r; }
    function startOfISOWeek(d){ // Monday as week start
      var r=new Date(d.getTime());
      var dow = (r.getDay()+6)%7; // Mon=0..Sun=6
      r.setDate(r.getDate()-dow);
      return r;
    }
    function clamp(d, a, b){
      return d < a ? a : (d > b ? b : d);
    }
    function isoWeekYear(d){
      // Week belongs to the year containing the Thursday
      var wday = (d.getDay()+6)%7; // 0..6
      var thu = addDays(d, 3 - wday);
      return thu.getFullYear();
    }
    function isoWeekNumber(d){
      var wday = (d.getDay()+6)%7;
      var thu = addDays(d, 3 - wday);
      var year = thu.getFullYear();
      var firstThu = new Date(year, 0, 4, 12); // Jan 4th, 12:00
      var week0 = startOfISOWeek(firstThu);
      var diffDays = Math.round((startOfISOWeek(thu)-week0)/(24*3600*1000));
      var wn = 1 + Math.round(diffDays/7);
      return ('0'+wn).slice(-2);
    }

    function skiWeek(d){
      // Swedish ski week (Sunday–Sunday)
      // Week 1 = the week that contains Jan 1
      // The YEAR is the year of Jan 1 in that week
    
      var sunday = startOfSundayWeek(d);
      var saturday = addDays(sunday, 6);
    
      // Determine which Jan 1 we should test against
      var year = sunday.getFullYear();
      var jan1 = new Date(year, 0, 1, 12);
    
      // If this week spills into January of the NEXT year,
      // then it belongs to the next ski year
      if (sunday.getMonth() === 11 && saturday.getMonth() === 0) {
        year = year + 1;
        jan1 = new Date(year, 0, 1, 12);
      }
    
      // Week 1: the week containing Jan 1
      if (jan1 >= sunday && jan1 <= saturday) {
        return { year: year, week: 1 };
      }
    
      // Otherwise count from the Sunday of week 1
      var firstSunday = startOfSundayWeek(jan1);
      var diffDays = Math.round((sunday - firstSunday) / (24*3600*1000));
      var week = 1 + Math.floor(diffDays / 7);
    
      return { year: year, week: week };
    }

    // ---- Sunday-based week helpers (for Sunday→Sunday stays) ----
    function startOfSundayWeek(d){
      var r = new Date(d.getTime());
      r.setDate(r.getDate() - r.getDay()); // Sunday = 0
      return r;
    }
  
    // locale-safe short month formatter (fallback if Intl missing)
    var MONTHS = ['jan','feb','mars','apr','maj','juni','juli','aug','sep','okt','nov','dec'];
    function fmtRange(a,b){
      try{
        if (typeof Intl !== 'undefined' && Intl.DateTimeFormat){
          var f = new Intl.DateTimeFormat('sv-SE', {day:'numeric', month:'short'});
          return f.format(a) + '–' + f.format(b);
        }
      }catch(_){}
      return a.getDate() + ' ' + MONTHS[a.getMonth()] + '–' + b.getDate() + ' ' + MONTHS[b.getMonth()];
    }
  
    function buildWeeks(seasonKey){
      var start = toDate(SEASONS[seasonKey].start),
          end   = toDate(SEASONS[seasonKey].end);
    
      // first Sunday on/after season start
      var c = startOfSundayWeek(start);
      if (c < start) c = addDays(c, 7);
    
      var out = [];
      while (c <= end){
        var ws = c;              // Sunday (arrival)
        var we = addDays(ws, 7); // Sunday (departure)
        var sw = skiWeek(ws);

        var key = sw.year + '-W' + ('0' + sw.week).slice(-2);
    
        out.push({
          key: key,
          week: sw.week,
          from: clamp(ws, start, end),
          to:   clamp(we, start, end)
        });
    
        c = addDays(c, 7);
      }
      return out;
    }
  
    function statusFor(key){
      return WEEK_STATUS.hasOwnProperty(key) ? WEEK_STATUS[key] : 'available';
    }
    
    function renderCalendar(seasonKey){
      var grid = document.getElementById('calendarGrid');
      var summary = document.getElementById('seasonSummary');
      if (!grid) return;
      grid.innerHTML = '';
  
      // Build weeks and group by month name (sv-SE)
      var fMonth = new Intl.DateTimeFormat('sv-SE', { month:'long', year:'numeric' });
      var weeks = buildWeeks(seasonKey);
  
      // Totals
      var count = { ok:0, pending:0, no:0 };
      // Group map: { "november 2025": [weekObjs...] }
      var groups = {};
      for (var i=0;i<weeks.length;i++){
        var w = weeks[i];
        var status = statusFor(w.key);                 // booked | pending | available
        var cls = (status==='booked'?'no':(status==='pending'?'pending':'ok'));
        if (cls==='no') count.no++; else if (cls==='pending') count.pending++; else count.ok++;
  
        var label = fMonth.format(w.from).toLowerCase(); // ex: "november 2025"
        if (!groups[label]) groups[label] = [];
        groups[label].push({ week:w.week, range:fmtRange(w.from, w.to), cls:cls });
      }
  
      // Render months
      Object.keys(groups).forEach(function(label){
        var row = document.createElement('div');
        row.className = 'monthRow';
  
        var name = document.createElement('div');
        name.className = 'monthName muted';
        name.textContent = label;
  
        var wrap = document.createElement('div');
        wrap.className = 'weeksWrap';
  
        groups[label].forEach(function(w){
          var pill = document.createElement('span');
          pill.className = 'weekPill ' + w.cls;
          pill.setAttribute('aria-label', 'Vecka ' + w.week + ' ' + w.range + (w.cls==='no'?' (Bokat)':w.cls==='pending'?' (På förfrågan)':' (Ledigt)'));
          pill.innerHTML = 'v' + w.week + '<span class="range">' + w.range + '</span>';
          // Intentionally no click handler; not interactive.
          wrap.appendChild(pill);
        });
  
        row.appendChild(name);
        row.appendChild(wrap);
        grid.appendChild(row);
      });
  
      // Summary line
      if (summary){
        var total = count.ok + count.pending + count.no;
        summary.textContent = 'Totalt ' + total + ' veckor • Lediga: ' + count.ok + ' • På förfrågan: ' + count.pending + ' • Bokat: ' + count.no;
      }
    }
  
    function setActiveSeason(key){
      var tabs = document.querySelectorAll('.toggleBtn');
      for (var i=0;i<tabs.length;i++){
        var a = (tabs[i].getAttribute('data-season')===key);
        if (a) { tabs[i].classList.add('active'); tabs[i].setAttribute('aria-selected','true'); }
        else   { tabs[i].classList.remove('active'); tabs[i].setAttribute('aria-selected','false'); }
      }
      renderCalendar(key);
    }
  
    // Init after DOM is ready
    (function(){
      function init(){
        setActiveSeason('winter'); // default season
        var tabs = document.querySelectorAll('.toggleBtn');
        for (var i=0;i<tabs.length;i++){
          tabs[i].addEventListener('click', function(){
            setActiveSeason(this.getAttribute('data-season'));
          });
        }
      }
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else { init(); }
    })();
  </script>
</body>
</html>
